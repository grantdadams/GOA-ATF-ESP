
# From ADMB:
# Obs_srv_agecomp_fem
# 7.90666e-05 0.00313498 0.0379455 0.0652694 0.108601 0.130278 0.0905713 0.0523955 0.0289754 0.0175692 0.0132002 0.0113169 0.0109475 0.0115989 0.0108947 0.00733653 0.00320759 0.000875116 0.000146982 1.45321e-05 0
# 0.000760599 0.0298807 0.125971 0.10811 0.0813278 0.0790064 0.0683911 0.0589958 0.0451463 0.0323879 0.0223119 0.0157865 0.0121851 0.00876744 0.00583284 0.00395838 0.00247833 0.00119619 0.000408521 9.80151e-05 1.83925e-05
# 0.00107533 0.0307406 0.0552633 0.0727462 0.106164 0.100667 0.0758981 0.0623449 0.045969 0.0333777 0.0284382 0.0223733 0.0150648 0.0103278 0.00826743 0.00735492 0.00638912 0.00493648 0.00326254 0.00188223 0.00189843
# 0.00296019 0.046004 0.0638507 0.0617656 0.0668547 0.0760286 0.0806364 0.0816902 0.0745241 0.0523471 0.0331168 0.0234664 0.0166097 0.0106142 0.0063218 0.00376536 0.0023633 0.00148951 0.00085809 0.00044536 0.000401546


# Check likelihoods
bridging_model_2a$quantities$jnll_comp

check <- bridging_model_2a$data_list$comp_data
check[,9:ncol(check)] <- bridging_model_2a$quantities$true_age_comp_hat
sum(check$Sample_size[1:16] * (bridging_model_2a$data_list$comp_data[1:16,9:50] + 0.000001) * log((check[1:16,9:50] + 0.000001)))
bridging_model_2a$quantities$jnll_comp[3,]/bridging_model_2a$data_list$fleet_control$Comp_weights

# model1_comp <- read.csv("atf model 1 age comp.csv")
#
# sum((model1_comp[1:16,3:23] + 0.000001) * log((model1_comp[17:32,3:23] + 0.000001)) + (model1_comp[33:48,3:23] + 0.000001) * log((model1_comp[49:64,3:23] + 0.000001))) * 400
#
# library(readxl)
# length_comps <- read_xlsx(path = "model 1 comps.xlsx", sheet = 2)
# obs_p <- length_comps %>%
#   filter(obs_p_fish_norm == "obs_p_fish_norm")
# pred_p <- length_comps %>%
#   filter(obs_p_fish_norm == "pred_p_fish" & Year %in% obs_p$Year)
#
# sum(obs_p$N * (obs_p[,5:ncol(obs_p)] + 0.000001) * log((pred_p[,5:ncol(pred_p)] + 0.000001)))

# From ADMB:
# Pred_srv_agecomp_fem
# 0.0130388 0.0338264 0.067657 0.0877003 0.0960432 0.0885791 0.0670319 0.0472871 0.0390952 0.0308334 0.0212311 0.0174427 0.0157855 0.0150555 0.0117996 0.0103732 0.00505266 0.00647735 0.00353869 0.00342746 0.0148114
# 0.0123368 0.0463766 0.122149 0.10918 0.072712 0.0529302 0.044865 0.0440604 0.0396867 0.0298525 0.0210064 0.0173447 0.0136712 0.00941238 0.00773074 0.00699647 0.00667363 0.00523103 0.00459975 0.00224102 0.0125365
# 0.00913608 0.0374923 0.0911718 0.106113 0.102383 0.0981026 0.0572967 0.034182 0.0242661 0.0204108 0.0199658 0.0179464 0.0134877 0.00948712 0.00783056 0.00617262 0.00425055 0.00349216 0.00316187 0.00301748 0.0111335
# 0.00726879 0.0337822 0.0796151 0.0924068 0.097198 0.0857543 0.0649369 0.0557884 0.0517306 0.0297498 0.0175838 0.0124335 0.010433 0.0101932 0.00915924 0.0068861 0.00484779 0.0040059 0.00316285 0.00218177 0.0106922
#
#
# bridging_model_2a$quantities$sel[,1,,1]
# bridging_model_2a$quantities$sel[,2,,1]
#
# head(bridging_model_2a$data_list$NByageFixed[,5:25])
# head(t(bridging_model_2a$quantities$NByage[1,1,1:21,1:47]))
#
#
# t(bridging_model_2a$quantities$NByage[1,1,1:21,1:47])/1000 - bridging_model_2a$data_list$NByageFixed[1:47,5:25]
